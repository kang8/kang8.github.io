<!doctype html><html lang=en><head><meta charset=UTF-8><title>如何在 neovim 中映射 command 键 - kitty 篇</title><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=generator content="Hugo 0.150.0"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=" kitty,neovim "><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.css integrity=sha384-Juol1FqnotbkyZUT5Z7gUPjQ9gzlwCENvUZTpQBAPxtusdwFLRy382PSDx5UUJ4/ crossorigin=anonymous><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/katex.min.js integrity=sha384-97gW6UIJxnlKemYavrqDHSX3SiygeOwIZhwyOKRfSaf0JWKRVj9hLASHgFTzT+0O crossorigin=anonymous></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.3/dist/contrib/auto-render.min.js integrity=sha384-+VBxd3r6XgURycqtZ117nYw44OOcIax56Z4dCRWbxyPt0Koah1uHoK0o4+/RRE05 crossorigin=anonymous onload=renderMathInElement(document.body)></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:!0},{left:"$",right:"$",display:!1}]})})</script><meta name=twitter:card content="summary"><meta name=twitter:title content="如何在 neovim 中映射 command 键 - kitty 篇"><meta name=twitter:description content='背景 在看最新（2022/9/12）的 This Week In Neovim 中发现了插件：Hvassaa/sterm.nvim。一个非常简单小插件，能够快速打开/关闭 terminal。 现以改用 lspsaga.nvim 中的 Float terminal。
我个人在 VsCode 和 PHPStorm 中也经常用到该功能，顺便整合到 nvim 中。
问题来了，我使用的快捷键是 VsCode 自带的按键 <cmd + j> 来切换 terminal。在 neovim 中 <D-…> 表示映射 command 键，但设置 <D-j> 后，没有生效。
至于在 neovim 中为何 command 键（在 Windows/Linux 中又叫 Super）不起作用，我目前并没有答案。
我的环境，供读者参考：
Hardware: Apple M1 MacBook Pro nvim version: v0.8.0 terminal emulator: kitty 0.26.3 解决 不优雅的方法 首先在互联网上找到了这个答案。
在 kitty 配置文件中添加下列代码：
map cmd+j send_text all :execute "normal \<d-j>"\r 该解决方法是完完全全的按键映射，也就是按下 <cmd + j> 后，kitty 会将其映射为 :execute "normal <d-j>"\r。'></head><body><header><div id=avatar><a href=https://kang8.github.io/><img src=https://cdn.jsdelivr.net/gh/yk17310320725/picBed/img/20200805204651.png alt="Kang's Blog"></a></div><div id=titletext><h2 id=titleonly><a href=https://kang8.github.io/>Kang's Blog</a></h2></div><div id=title-social><div id=social><nav><ul><li><a href=https://github.com/kang8><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://twitter.com/kang__98><i title=Twitter class="icons fab fa-twitter"></i></a></li><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li><li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/books>Books</a></li><li><a href=/about>About</a></li></ul></nav></div></header><main><div class=post><article><div class=post-header><div class=meta><div class=date><span class=day>14</span>
<span class=rest>Sep 2022</span></div></div><div class=matter><h1 class=title>如何在 neovim 中映射 command 键 - kitty 篇</h1><p class=post-meta><span class=post-meta></span></p></div></div><div class=markdown><h2 id=背景>背景</h2><p>在看<a href=https://this-week-in-neovim.org/2022/Sep/12 target=_blank>最新（2022/9/12）</a>的 This Week In Neovim 中发现了插件：<a href=https://github.com/Hvassaa/sterm.nvim target=_blank>Hvassaa/sterm.nvim</a>。<del>一个非常简单小插件，能够快速打开/关闭 terminal。</del> 现以改用 lspsaga.nvim 中的 <a href="https://github.com/glepnir/lspsaga.nvim/blob/5f17b9b7a8becc7d1593aae80d263ec936ae5ca7/README.md?plain=1#L459-L467" target=_blank>Float terminal</a>。</p><p>我个人在 VsCode 和 PHPStorm 中也经常用到该功能，顺便整合到 nvim 中。</p><p>问题来了，我使用的快捷键是 VsCode 自带的按键 <a href=https://github.com/microsoft/vscode/blob/28e52a46fe8df0c924c881e438e124c05f171b9c/src/vs/workbench/browser/parts/panel/panelActions.ts#L325 target=_blank>&lt;cmd + j></a> 来切换 terminal。在 neovim 中 <a href=https://github.com/neovim/neovim/blob/1e5daed67693f88d3ad515cf9e2d2f6d29c48a08/runtime/doc/intro.txt#L375 target=_blank>&lt;D-…></a> 表示映射 command 键，但设置 <code>&lt;D-j></code> 后，没有生效。</p><blockquote><p>至于在 neovim 中为何 command 键（在 Windows/Linux 中又叫 Super）不起作用，我目前并没有答案。</p></blockquote><p>我的环境，供读者参考：</p><ul><li>Hardware: Apple M1 MacBook Pro</li><li>nvim version: v0.8.0</li><li>terminal emulator: kitty 0.26.3</li></ul><h2 id=解决>解决</h2><h3 id=不优雅的方法>不优雅的方法</h3><p>首先在互联网上找到了这个<a href=https://github.com/kovidgoyal/kitty/issues/2706#issuecomment-886174507 target=_blank>答案</a>。</p><p>在 kitty 配置文件中添加下列代码：</p><pre tabindex=0><code class=language-conf data-lang=conf>map cmd+j send_text all :execute &#34;normal \&lt;d-j&gt;&#34;\r
</code></pre><p>该解决方法是完完全全的按键映射，也就是按下 <code>&lt;cmd + j></code> 后，kitty 会将其映射为 <code>:execute "normal &lt;d-j>"\r</code>。</p><p>该方式可以解决按键映射，但不够优雅。按下 <code>&lt;cmd + j></code> 后，会在命令行窗口显示该命令。</p><p><figure><img src=direct-key-mapping.png alt="direct key mapping"></figure></p><p>更要命的是该按键是全局的，无论是否在 neovim 中。比如在 shell 中无意触发该映射，会打断我的思路。</p><h3 id=不是最优解但可以接受>不是最优解，但可以接受</h3><p>在寻找的过程中还存在一种声音：不使用 <code>&lt;command></code> 键，而是改用诸如 <code>&lt;leader></code> <code>&lt;control></code> <code>&lt;shift></code> 等 neovim 支持的很好的按键。</p><p>但我并不想妥协，在 MacOs 中 <code>&lt;cmd + j></code> 对我来说是一个非常顺手的键位，并且我也想搞清楚 <code>&lt;command></code> 键的映射方式，于是继续寻找答案。</p><p>最后在 V2EX 上找到 <a href=https://github.com/skywind3000 target=_blank>skywind3000</a> 的回答<sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup>，再借助 kitty 对 <a href=https://sw.kovidgoyal.net/kitty/keyboard-protocol target=_blank>keyboard-protocol</a> 的支持，就能完成 command 的按键映射。</p><p>该做法的解决思路为：既然不能直接映射 command 键，那我退而求其次将我需要的按键映射成 neovim 支持很好的按键。对于 neovim 来说 F 按键就是非常好的选择。除了 &lt;F1>-&lt;F12> 外还有 &lt;F13>-&lt;F37> 一共 25 个虚拟按键，由于使用频率非常少，所以是映射 command 的最佳选择。</p><p>具体步骤，我是用 &lt;F14> 来映射：</p><ol><li><p>首先在 kitty 中运行内置命令 <code>kitty +kitten show_key</code> 中输入 <code>shift + &lt;F2></code> 拿到 &lt;F14> 的 key。</p></li><li><p>在 kitty 的配置文件中，将 <code>cmd + j</code> 映射成 &lt;F14> 的 key</p></li></ol><pre tabindex=0><code class=language-conf data-lang=conf>map cmd+j send_text all \x1b[1;2Q 
</code></pre><ol start=3><li>在 nvovim 中将 &lt;F14> 映射成对应命令</li></ol><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-lua data-lang=lua><span style=display:flex><span>vim.keymap.set(<span style=color:#e6db74>&#39;n&#39;</span>, <span style=color:#e6db74>&#39;&lt;F14&gt;&#39;</span>, <span style=color:#e6db74>&#39;&lt;Cmd&gt;Lspsaga open_floaterm&lt;CR&gt;&#39;</span>, opts)
</span></span><span style=display:flex><span>vim.keymap.set(<span style=color:#e6db74>&#39;t&#39;</span>, <span style=color:#e6db74>&#39;&lt;F14&gt;&#39;</span>, <span style=color:#e6db74>[[&lt;C-\&gt;&lt;C-n&gt;&lt;Cmd&gt;Lspsaga close_floaterm&lt;CR&gt;]]</span>, opts)
</span></span></code></pre></div><p>这个做法虽然没有解决实际的问题，但比通过 kitty 直接映射的方式好用。</p><h2 id=参考>参考</h2><ul><li><a href=https://www.reddit.com/r/neovim/comments/mbj8m5/how_to_setup_ctrlshiftkey_mappings_in_neovim_and target=_blank>如何使用 alacritty 在 neovim 上 map ctrl + shift + key</a></li><li><a href=http://www.leonerd.org.uk/hacks/fixterms/ target=_blank>Fix Keyboard Input on Terminals</a></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href="https://www.v2ex.com/t/318520?p=1#r_3743712" target=_blank>https://www.v2ex.com/t/318520?p=1#r_3743712</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/kitty/>kitty</a>
<a href=/tags/neovim/>neovim</a></p></div><div class=clearit></div></div><div id=giscus-comments class=giscus style=margin-top:50px></div><script src=https://giscus.app/client.js data-repo=kang8/kang8.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzOTQzMTc5NTk=" data-category=General data-category-id=DIC_kwDOF4DQh84CPHHt data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light crossorigin=anonymous async></script></article></div></main><script src=/js/dark-mode.js></script></body></html>