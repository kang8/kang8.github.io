<!doctype html><html lang=en><head><meta charset=utf-8><title>如何使用 Homebrew 在 macOS 中切换 PHP 版本</title><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Hugo 0.102.3"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=keywords content=" php,homebrew,tips "><link rel=icon type=image/png href=/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/favicon-16x16.png sizes=16x16><link rel=stylesheet type=text/css media=screen href=/css/normalize.css><link rel=stylesheet type=text/css media=screen href=/css/main.css><link rel=stylesheet type=text/css media=screen href=/css/all.css><meta name=twitter:card content="summary"><meta name=twitter:title content="如何使用 Homebrew 在 macOS 中切换 PHP 版本"><meta name=twitter:description content="TLDR 安装不同版本的 PHP
# php version in [7.2, 7.3, 7.4, 8.0, 8.1] brew install php@7.4 # or use shivammathur/homebrew-php tap brew install shivammathur/php/php@7.4 # php version in [5.6, 7.0, 7.1] # only can use shivammathur/homebrew-php tap brew install shivammathur/php/php@7.1 切换版本
brew unlink php@7.4 brew link php@7.1 起因 为了追查 Laravel 5.8 的一个 RCE 漏洞，我需要在本机复现。当我安装完 Laravel 5.8 后，执行 composer install 安装依赖却没成功：
$ composer install Your requirements could not be resolved to an installable set of packages."></head><body><header><div id=avatar><a href=https://kang8.github.io/><img src=https://cdn.jsdelivr.net/gh/yk17310320725/picBed/img/20200805204651.png alt="Kang's Blog"></a></div><div id=titletext><h2 id=titleonly><a href=https://kang8.github.io/>Kang's Blog</a></h2></div><div id=title-social><div id=social><nav><ul><li><a href=https://github.com/kang8><i title=Github class="icons fab fa-github"></i></a></li><li><a href=https://twitter.com/kang__98><i title=Twitter class="icons fab fa-twitter"></i></a></li><li><a href=/index.xml><i title=RSS class="icons fas fa-rss"></i></a></li><li><a><i title="Switch Dark Mode" class="dark-mode icons fas fa-moon"></i></a></li></ul></nav></div></div><div id=mainmenu><nav><ul><li><a href=/>Home</a></li><li><a href=/posts>Posts</a></li><li><a href=/about>About</a></li></ul></nav></div></header><main><div class=post><article><div class=post-header><div class=meta><div class=date><span class=day>14</span>
<span class=rest>May 2022</span></div></div><div class=matter><h1 class=title>如何使用 Homebrew 在 macOS 中切换 PHP 版本</h1><p class=post-meta><span class=post-meta></span></p></div></div><div class=markdown><h2 id=tldr>TLDR</h2><p>安装不同版本的 PHP</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span><span style=color:#6272a4># php version in [7.2, 7.3, 7.4, 8.0, 8.1]</span>
</span></span><span style=display:flex><span>brew install php@7.4
</span></span><span style=display:flex><span><span style=color:#6272a4># or use shivammathur/homebrew-php tap</span>
</span></span><span style=display:flex><span>brew install shivammathur/php/php@7.4
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#6272a4># php version in [5.6, 7.0, 7.1]</span>
</span></span><span style=display:flex><span><span style=color:#6272a4># only can use shivammathur/homebrew-php tap</span>
</span></span><span style=display:flex><span>brew install shivammathur/php/php@7.1
</span></span></code></pre></div><p>切换版本</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew unlink php@7.4
</span></span><span style=display:flex><span>brew link php@7.1
</span></span></code></pre></div><h2 id=起因>起因</h2><p>为了追查<a href=https://www.cnvd.org.cn/flaw/show/CNVD-2022-36040 target=_blank> Laravel 5.8 的一个 RCE 漏洞</a>，我需要在本机复现。当我安装完 Laravel 5.8 后，执行 <code>composer install</code> 安装依赖却没成功：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ composer install
</span></span><span style=display:flex><span>Your requirements could not be resolved to an installable <span style=color:#8be9fd;font-style:italic>set</span> of packages.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  Problem <span style=color:#bd93f9>1</span>
</span></span><span style=display:flex><span>    - Root composer.json requires php ^7.1.3 but your php version <span style=color:#ff79c6>(</span>8.1.5<span style=color:#ff79c6>)</span> does not satisfy that requirement.
</span></span><span style=display:flex><span>  Problem <span style=color:#bd93f9>2</span>
</span></span><span style=display:flex><span>    - laravel/framework<span style=color:#ff79c6>[</span>v5.8.0, ..., 5.8.x-dev<span style=color:#ff79c6>]</span> require php ^7.1.3 -&gt; your php version <span style=color:#ff79c6>(</span>8.1.5<span style=color:#ff79c6>)</span> does not satisfy that requirement.
</span></span><span style=display:flex><span>    - Root composer.json requires laravel/framework 5.8.* -&gt; satisfiable by laravel/framework<span style=color:#ff79c6>[</span>v5.8.0, ..., 5.8.x-dev<span style=color:#ff79c6>]</span>.
</span></span></code></pre></div><p>Laravel 5.8 最高支持的 PHP 版本为 7.1。所以我得降版本。</p><blockquote><p>在工作中，也会遇到类似的问题：追踪以前的代码时有些场景可能需要安装依赖，但版本并不匹配，之前都是跳过，寻找别的解决方案。正好借此机会总结一下。</p></blockquote><h2 id=解决>解决</h2><p>search 一下发现 <a href=https://github.com/Homebrew/homebrew-core target=_blank>Homebrew core</a> 只维护了 <a href=https://github.com/Homebrew/homebrew-core/blob/5d0f563955ccb6a22577838df57242f2d62ca060/Formula/php%407.2.rb target=_blank>php@7.2</a> 以上的版本：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>$ brew search --formula <span style=color:#8be9fd;font-style:italic>php</span>
</span></span><span style=display:flex><span><span style=color:#ff79c6>==</span>&gt; Formulae
</span></span><span style=display:flex><span>brew-php-switcher      php-cs-fixer           php@7.3                phpbrew                phpmyadmin             pcp
</span></span><span style=display:flex><span>php ✔                  php-cs-fixer@2         php@7.4                phplint                phpstan                pup
</span></span><span style=display:flex><span>php-code-sniffer       php@7.2                php@8.0 ✔              phpmd                  phpunit
</span></span></code></pre></div><p>从上面的结果中发现了 <a href=https://github.com/phpbrew/phpbrew target=_blank>phpbrew</a>。它安装完后还需要设置环境变量，有点麻烦，并且<a href=https://github.com/phpbrew/phpbrew/commit/0aac194e897469ce7448e37077b4db95b0a20dfb target=_blank>最近一次提交</a>在 2021/1/31 就觉得不太靠谱，放弃。</p><p>通过搜索找到了 <a href=https://github.com/laravel/valet target=_blank>Valet</a>，它是 Laravel 团队开发的在 Mac 上快速搭建 PHP 开发环境的工具。</p><p>在<a href=https://github.com/laravel/valet/blob/master/cli/Valet/PhpFpm.php#L16-L19 target=_blank>代码中</a>可以看到，它通过 <a href=https://github.com/shivammathur/homebrew-php target=_blank>shivammathur/homebrew-php</a> tap 来安装 Homebrew core 没有维护的 PHP 版本。其中就包含了我想要的 php@7.1：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash><span style=display:flex><span>brew install shivammathur/php/php@7.1
</span></span></code></pre></div><p>安装完成后，使用 Homebrew 中的 link/unlink ，将 PHP 版本设置为 7.1：</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#282a36;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-fallback data-lang=fallback><span style=display:flex><span>brew unlink php
</span></span><span style=display:flex><span>brew link php@7.1
</span></span></code></pre></div><p>最后愉快的在 Laravel 5.8 中 <code>composer install</code></p><h2 id=ref>Ref</h2><ul><li><a href=https://learnku.com/laravel/t/67866 target=_blank>https://learnku.com/laravel/t/67866</a></li></ul></div><div class=tags><div class=taxosfloating_left><p>Tags</p></div><div class=termsfloating_right><p><a href=/tags/homebrew/>homebrew</a>
<a href=/tags/php/>php</a>
<a href=/tags/tips/>tips</a></p></div><div class=clearit></div></div><div id=giscus-comments class=giscus style=margin-top:50px></div><script src=https://giscus.app/client.js data-repo=kang8/kang8.github.io data-repo-id="MDEwOlJlcG9zaXRvcnkzOTQzMTc5NTk=" data-category=General data-category-id=DIC_kwDOF4DQh84CPHHt data-mapping=title data-reactions-enabled=1 data-emit-metadata=0 data-input-position=top data-theme=light crossorigin=anonymous async></script></article></div></main><script src=/js/dark-mode.js></script></body></html>